Версия 1.0  
---

### **Техническое задание: W3B2: The Web3-to-Web2 Bridge Protocol**

**W3B2: Протокол, который обеспечивает безопасность и верификацию Web3 с гибкостью и производительностью Web2.******

---

#### **1\. Компоненты системы**

* **Программа (смарт-контракт) Solana:** **Брокер и валидатор сообщений.** Его основная задача — принимать команды от клиентов и сервисов, проверять их подлинность (используя program\_id и подписи) и служить единственным источником правды для всех сторон. Программа регистрирует намерение и подтверждает, что оно исходит от авторизованного пользователя.  
* **Изолированный сервис:** Программа, которая работает в закрытой сети, имеет доступ к базе данных и слушает блокчейн. **Состоит из двух крейтов:** bridge (для чтения блокчейна и управления соединениями) и data (для работы с БД, например, PostgreSQL).  
* **Клиентское приложение:** Программа пользователя, которая генерирует ключи, отправляет зашифрованные команды и устанавливает HTTP-соединение с сервисом.  
* **Клиент администратора:** Специализированное клиентское приложение с уникальным ключом для управления доступом и привилегированными операциями.

---

#### **2\. Архитектура и основной процесс**

1. **Регистрация (Безопасный обмен ключами):**  
   * **Клиент** генерирует пару ключей (priv\_client, pub\_client). priv\_client шифруется паролем пользователя.  
   * **Клиент** отправляет pub\_client в транзакции на программу Solana.  
   * **Изолированный сервис**, слушая блокчейн, находит эту транзакцию и создает ответную транзакцию со своим публичным ключом (pub\_service).  
   * **Клиент** принимает pub\_service и сохраняет его.  
2. **Передача команды:**  
   * **Клиент** хочет выполнить операцию.  
   * Он создает сообщение, содержащее enum\-инструкцию и зашифрованную конфигурацию подключения.  
   * Это сообщение шифруется с использованием pub\_service и отправляется на программу Solana.  
   * **Сервис** считывает транзакцию, расшифровывает сообщение, используя priv\_service.  
3. **Установка защищённого канала и передача данных:**  
   * На основе расшифрованной информации, **сервис** открывает доступ только для IP-адреса клиента.  
   * Устанавливается защищённое HTTP-соединение. Каждое действие шифруется парой ключей, которые были получены на этапе регистрации.  
   * После завершения операции соединение закрывается.

---

#### **3\. API программы Solana (Инструкции)**

Каждая инструкция имеет две версии:

* **Запрос-Ответ (Req-Res):** A \-\> Blockchain \-\> B. Сервис B выполняет команду и отправляет B \-\> Blockchain \-\> A для подтверждения.  
* **One-Way (Fire-and-Forget):** A \-\> Blockchain \-\> B. Сервис B выполняет команду, но не отправляет подтверждения.

| Идентификатор (Req-Res) | Идентификатор (One-Way) | Название          | Описание                                                                               |
| :---------------------- | :---------------------- | :---------------- | :------------------------------------------------------------------------------------- |
| 0x01                    | 0x02                    | RegisterUser      | Регистрирует пользователя. Принимает pub\_client. Сервис отвечает своим pub\_service.  |
| 0x03                    | 0x04                    | RequestConnection | Запрашивает установку соединения. Принимает зашифрованный конфиг.                      |
| 0x05                    | 0x06                    | CRUD\_Create      | Создаёт новую запись в БД. Принимает зашифрованный конфиг и таймер ожидания данных.    |
| 0x07                    | 0x08                    | CRUD\_Read        | Читает данные из БД. Принимает зашифрованный конфиг и идентификатор данных.            |
| 0x09                    | 0x0A                    | CRUD\_Update      | Обновляет существующую запись. Принимает зашифрованный конфиг, идентификатор и таймер. |
| 0x0B                    | 0x0C                    | CRUD\_Delete      | Удаляет данные из БД. Принимает зашифрованный конфиг и идентификатор.                  |
| 0x0D                    | 0x0E                    | StartSession      | Устанавливает соединение для нескольких команд (для чтения и изменения).               |
| 0x0F                    | 0x10                    | EndSession        | Закрывает сессию.                                                                      |

---

#### **4\. Дополнительные требования**

* **Администрирование:**  
  * Уникальный ключ администратора, зарегистрированный в сервисе, может инициировать специальные команды через блокчейн (например, дать разрешение на изменение всей БД).  
* **Оптимизация стоимости:**  
  * Каждая транзакция должна стоить минимум (около 5000 лампортов).  
  * Для этого используем enum и сжатые данные.  
* **Гибкость:**  
  * Остальные числовые идентификаторы могут использоваться для запуска любого другого кода на стороне сервиса.

