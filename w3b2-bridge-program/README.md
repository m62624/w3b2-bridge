# W3B2 Bridge Program

Solana программа для протокола W3B2 Bridge, обеспечивающая безопасное взаимодействие между Web3 и Web2 сервисами.

## Описание

Этот компонент представляет собой смарт-контракт на блокчейне Solana, написанный на Rust с использованием Anchor framework. Программа служит единственным доверенным каналом коммуникации между пользователями и Web2 сервисами.

## Основные функции

### 1. Управление аккаунтами
- **Регистрация администраторов** (`register_admin`) - создание PDA для администратора с начальным финансированием
- **Регистрация пользователей** (`register_user`) - создание PDA для пользователя
- **Деактивация аккаунтов** (`deactivate_admin`, `deactivate_user`)

### 2. Система финансирования
- **Запрос финансирования** (`request_funding`) - пользователь запрашивает средства у администратора
- **Одобрение финансирования** (`approve_funding`) - администратор одобряет и переводит средства

### 3. Отправка команд
- **Отправка команд** (`dispatch_command_admin`, `dispatch_command_user`) - передача зашифрованных команд между Web3 и Web2

## Архитектура

### PDA (Program Derived Addresses)
- `AdminAccount`: `[b"admin", authority.key()]` - хранит данные администратора
- `UserAccount`: `[b"user", co_signer.key()]` - хранит данные пользователя  
- `FundingRequest`: `[b"funding", user_wallet.key(), payer.key()]` - запросы на финансирование

### События
- `AdminRegistered` - регистрация администратора
- `UserRegistered` - регистрация пользователя
- `FundingRequested` - запрос на финансирование
- `FundingApproved` - одобрение финансирования
- `CommandEvent` - отправка команды

## Безопасность

- Все операции проверяются через подписи и PDA
- Статусы запросов защищают от двойного одобрения
- Баланс PDA контролирует перерасход средств
- Все действия логируются через события

## Развертывание

```bash
# Сборка программы
anchor build

# Развертывание на localnet
anchor deploy

# Развертывание на devnet
anchor deploy --provider.cluster devnet
```

## Конфигурация

Программа ID: `3LhCu6pXXdiwpvBUrFKLxCy1XQ5qyE7v6WSCLbkbS8Dr`

## Тестирование

```bash
# Запуск тестов
anchor test

# Запуск конкретного теста
anchor test -- --test test_name
```

## Структура проекта

```
src/
├── lib.rs              # Основная программа
├── instructions.rs     # Логика инструкций
├── types.rs           # Типы данных
├── events.rs          # События
├── errors.rs          # Ошибки
└── sm_accounts.rs     # Структуры аккаунтов
```
